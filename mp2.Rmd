---
title: "Mini-Project 2"
author: "Karina Lieb, Alexis Kilayko, and Olivia Baldwin"
date: "March 22, 2018"
output: 
  html_document:
    code_folding: hide
---

```{r, include = FALSE}
#loading the data
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
library(tidyverse)
```

```{r, warning = FALSE, message = FALSE}
# spending by state (which state's elections are most contributed to?)

#wrangling : creating new data frame with relevant information from contributions data frame

# wrangling : creating new data frame with relevant information from contributions data frame

#function to see spending by a variable
spending_by <- function(grouping) {
  

state_spending <- contributions %>%
  subset(state != '') %>% 
  group_by(state) %>%
  summarise(total_cont = sum(transaction_amt)) %>%
  arrange(desc(total_cont))

# plotting
ggplot(data = state_spending, aes(x = reorder(state,-total_cont), y = total_cont)) +
  geom_col() 
}
+
  theme(axis.text.x = element_text(size = rel(0.9), angle = 80, hjust = 1)) +

  ggtitle("Spending By State") +
  labs(x = "State", y = "Total Contribution (million dollars)") +

  ggtitle("Total Contributions to Committees by State \n(2011-2012 Federal Election Cycle)") +
  labs(x = "State", y = "Total Contributions (millions of dollars)") +

  scale_y_continuous(breaks = c(0e+00, 1e+08, 2e+08, 3e+08, 4e+08),
                     labels = c("0", "100", "200", "300", "400"))
```

For our second graph, we wanted to examine if there was a correlation between the amount of money given to a candidate committee and whether or not the candidate won or lost in the general election. We also wanted to examine whether a candidate's incumbency affected win or loss.  We mapped candidate committee to the x-axis, transaction sum of contributions to the y-axis, loss or win to color, and incumbency by facet wrap.

```{r, warning = FALSE, message = FALSE}
# sum of money given to candidate committees

# wrangling : creating new data frame with relevant information from contributions data frame
contributions_org <- contributions %>%
  select(cand_id, transaction_amt) %>%
  group_by(cand_id) %>%
  summarize(transaction_sum = sum(transaction_amt))

# wrangling : creating new data frame with relevant information from house_elections data frame
house_elections_org <- house_elections %>%
  select(fec_id, ge_winner, incumbent) %>%
  rename(cand_id = fec_id)

# wrangling : joining two new data frames
cand_spending <- inner_join(contributions_org, house_elections_org, by = "cand_id")

# wrangling : changing names of observations
cand_spending <- cand_spending %>%
  mutate(new_incumbent = ifelse(incumbent == "TRUE", "Incumbent", "Not Incumbent"),
         new_ge_winner = ifelse(ge_winner == "W", "Win", "Loss"))

# plotting
ggplot(data = cand_spending, aes(x = cand_id, y = transaction_sum, col = new_ge_winner)) +
  geom_point() +
  facet_wrap(~new_incumbent) +
  theme(axis.text.x = element_blank()) +

  ggtitle("Sum of Money Given to House Candidate Committees \n(2011-2012 Federal Election Cycle)") +
  labs(x = "Candidate Committee", y = "Transaction Sum (millions of dollars)", col = "Loss or Win in General Election") +

  scale_y_continuous(breaks = c(0e+00, 2e+06, 4e+06, 6e+06),
                     labels = c("0", "2", "4", "6"))
```

```{r, warning = FALSE, message = FALSE}
# name and types/designations of the highest-contributing committees

# wrangling relevant variables from committee
committee_info <- committees %>%
  select(cmte_id, cmte_dsgn, org_type, cand_id)

# wrangling relevant data from contributions
contribution_info <- contributions %>%
  select(cmte_id, entity_type, transaction_amt, other_id, cand_id)

# joining the two observations
contri_commit <- committee_info %>%
  full_join(contribution_info, by = c("cmte_id", "cand_id"))

# graphing it
mutable_data <- contri_commit %>%
  filter(!is.na(org_type)) %>%
  group_by(org_type) %>%
  filter(str_detect(cand_id, "H")) %>%
  arrange(desc(transaction_amt))

ggplot(mutable_data, aes(x = cmte_dsgn, y = transaction_amt, fill = org_type)) +
  geom_bar(stat = "identity", position = position_dodge(), width  = 0.7) +
  theme(legend.position = "top",
        axis.text.x = element_text(size = rel(0.9), angle = 6, hjust = 1))
  # scale_x_discrete(name = "Interest Group Category",
  #                  labels = c("Individual","Corp.","Labor Org.","Membership Org.", "Trade Assn.","Cooperative","Corp. w/o capital stock"))

# write a function for the graphical representation of this!
```
[^1]: Link to GitHub repository: https://github.com/akilayko/sds192-mp2
