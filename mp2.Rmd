---
title: "Mini-Project 2"
author: "Karina Lieb, Alexis Kilayko, and Olivia Baldwin"
date: "March 22, 2018"
output: 
  html_document:
    code_folding: hide
---

```{r, include = FALSE}
#loading the data
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
library(tidyverse)
```

This graphic shows 


```{r, warning = FALSE, message = FALSE}
# spending by state (which state's elections are most contributed to?)

#function to see state spending by different types of committees (entity)
entity_picker <- function(entity){

  # wrangling : creating new data frame with relevant information from contributions data frame
  state_spending <- contributions %>%
    filter(entity_type == entity) %>%
    subset(state != '') %>% 
    group_by(state) %>%
    summarise(total_cont = sum(transaction_amt)) %>%
    arrange(desc(total_cont))

  # plotting
  ggplot(data = state_spending, aes(x = reorder(state,-total_cont), y = total_cont)) +
    geom_col() +
    
    theme(axis.text.x = element_text(size = rel(0.9), angle = 80, hjust = 1)) +
  
    ggtitle("Spending By State") +
    labs(x = "State", y = "Total Contribution (million dollars)") +
  
    ggtitle(paste("Total Contributions from", entity, "Committees by State \n(2011-2012 Federal Election Cycle)", sep = " ")) +
    labs(x = "State", y = "Total Contributions (millions of dollars)") +

    scale_y_continuous(trans = "log2")
}

entity_picker(entity = "PAC")
entity_picker(entity = "ORG")
entity_picker(entity = "PTY")
```

For our second graph, we wanted to examine if there was a correlation between the amount of money given to a candidate committee and whether or not the candidate won or lost in the general election.  We additionally wanted to examine whether a candidate's incumbency affected win or loss.  To accomplish this, we mapped candidate committee to the x-axis and transaction sum of contributions to the y-axis, using a dot plot to most effectively show overall trends.  We then mapped win or loss to color for a clear contrast, and we facet wrapped by incumbency to display two distinct graphs side by side.

From this graph, we can learn that higher contributions do not necessarily correlate to victory, that incumbents are more likely to win than non-incumbents, and that victories are most likely for those who receive relatively little in contributions and are incumbent.  The results contrasted with our expectation that the more money contributed to the committee, the more likely the candidate was to win.  However, the results did match our expectation that incumbents have a higher frequency of victory due to their experience and visibility among the constituency.

```{r, warning = FALSE, message = FALSE}
# sum of money given to candidate committees

# wrangling : creating new data frame with relevant information from contributions data frame
contributions_org <- contributions %>%
  select(cand_id, transaction_amt) %>%
  group_by(cand_id) %>%
  summarize(transaction_sum = sum(transaction_amt))

# wrangling : creating new data frame with relevant information from house_elections data frame
house_elections_org <- house_elections %>%
  select(fec_id, ge_winner, incumbent) %>%
  rename(cand_id = fec_id)

# wrangling : joining two new data frames
cand_spending <- inner_join(contributions_org, house_elections_org, by = "cand_id")

# wrangling : changing names of observations
cand_spending <- cand_spending %>%
  mutate(new_incumbent = ifelse(incumbent == "TRUE", "Incumbent", "Not Incumbent"),
         new_ge_winner = ifelse(ge_winner == "W", "Win", "Loss"))

# plotting
ggplot(data = cand_spending, aes(x = cand_id, y = transaction_sum, col = new_ge_winner)) +
  geom_point() +
  facet_wrap(~new_incumbent) +
  theme(axis.text.x = element_blank()) +

  ggtitle("Sum of Money Given to House Candidate Committees \n(2011-2012 Federal Election Cycle)") +
  labs(x = "Candidate Committee", y = "Transaction Sum (millions of dollars)", col = "Loss or Win in General Election") +

  scale_y_continuous(breaks = c(0e+00, 2e+06, 4e+06, 6e+06),
                     labels = c("0", "2", "4", "6"))
```

For our third and final graph, we wanted to examine if there is a trend with the categorization (entity types) of the highest campaign donors during this election cycle. In addition, some wrangling based on the percent of all contributing donors that the entity types make up was also conducted. To view this data, we mapped the discrete entity types to the x-axis, the sum of donations to the y-axis, and mapped the percentage of total entity groups of this category out of all entity groups to a two-color gradient scale.

From this graph, we learn that groups with invalid entity categorizations and candidates donated the most in total during the election cycle. Another conclusion that can be drawn is that although the lions' share of the groups who donate are candidate entities, the invalid entities that represent fewer than a quarter of the donation groups donates at least ten times more money than any other group with similar representation percentage. The implications of this data is that some loopholes and liberties of the FEC's guidlines are being taken, for there are limits on how much certain entities can contribute to campaigns, but if the said entities do not conform to such categories, there is no limit on that entitiy's fiscal involvement, and that is made clear by the astronomical amount of their involvement. 

```{r, warning = FALSE, message = FALSE}
# name and types/designations of the highest-contributing committees

# write a function for the graphical representation of this!
contributions_by <- function(govt_entity) {
# wrangling relevant variables from committee
committee_info <- committees %>%
  select(cmte_id, cmte_dsgn, cmte_type, org_type, cand_id)

# wrangling relevant data from contributions
contribution_info <- contributions %>%
  select(cmte_id, entity_type, transaction_amt, other_id, cand_id)

# wrangling data from house elections
house_elections_info <- house_elections %>%
  select(fec_id, ge_winner, incumbent, party) %>%
  rename(cand_id = fec_id)

# joining observations of contributions and committees
contri_commit <- committee_info %>%
  full_join(contribution_info, by = c("cmte_id", "cand_id"))

# joining election info
contri_commit <- contri_commit %>%
  right_join(house_elections_info, by = "cand_id")

# data for graph
mutable_data <- contri_commit %>%
  filter(!is.na(entity_type)) %>%
  group_by(entity_type) %>%
  filter(str_detect(cand_id, govt_entity))

mutable_data <- mutable_data %>%
  mutate(entity_count = n(),
         percent = entity_count/nrow(mutable_data)*100,
         transaction_sum = sum(transaction_amt)) %>%
  arrange(desc(transaction_sum))

# graphing it
ggplot(mutable_data, aes(x = reorder(entity_type, -transaction_sum), y = transaction_sum, fill = percent)) +
  geom_bar(stat = "identity", position = position_dodge(), width  = 0.7) +
  theme(axis.text.x = element_text(size = rel(0.9), angle = 7.5, hjust = 1))
}

# making a plot by House candidates
plot_3 <- contributions_by(govt_entity = "H")

# bells and whistles
plot_3 +
  ggtitle("Contribution to House Candidates by Entity Type\n(2011-2012 Federal Election Cycle)") +
  labs(x = "Entity Type", y = "Net Amount of Donations by Entities (millions of dollars)", fill = "Percentage\nof Entities") +
  scale_x_discrete(labels = c("Inv.", "Cand.", "Cand. Cmte.", "Cmte.", "Indv.", "Org.", "Pol. Actn. Cmte.", "Pty. Org.")) +
  scale_y_continuous(breaks = c(0, 50000000, 100000000, 150000000, 200000000, 250000000, 300000000),
                     labels = c("0", "50", "100", "150", "200", "250", "300")) +
  scale_fill_gradient(low = "#b6f9dc", high = "#01693c",
                        breaks = c(25,50,75),
                        labels = c("25%", "50%", "75%"))
```



^1^: Link to GitHub repository: https://github.com/akilayko/sds192-mp2
